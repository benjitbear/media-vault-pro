<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ library_name }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>tailwind.config = { darkMode: 'class' }</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.4/socket.io.min.js"></script>
    <style>
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse-bar { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        .status-pulse { animation: pulse-bar 2s ease-in-out infinite; }
        .drop-zone { border: 2px dashed transparent; transition: all 0.3s; }
        .drop-zone.dragover { border-color: #6366f1; background: rgba(99,102,241,0.08); }
        .type-badge { font-size: 0.65rem; letter-spacing: 0.05em; }
        .progress-thumb { position: absolute; bottom: 0; left: 0; height: 3px; background: #6366f1; transition: width 0.3s; }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-white min-h-screen transition-colors duration-300">

    <!-- Status Bar (active rip) -->
    <div id="status-bar" class="hidden fixed top-0 left-0 right-0 bg-indigo-600 text-white px-4 py-2 z-50 status-pulse">
        <div class="max-w-7xl mx-auto flex items-center justify-between text-sm">
            <span>üîÑ <span id="status-title">Encoding...</span></span>
            <div class="flex items-center gap-3">
                <span id="status-eta" class="opacity-80"></span>
                <div class="w-32 bg-indigo-800 rounded-full h-2">
                    <div id="status-progress-bar" class="bg-white rounded-full h-2 transition-all duration-300" style="width:0%"></div>
                </div>
                <span id="status-percent" class="font-mono w-14 text-right">0%</span>
            </div>
        </div>
    </div>

    <!-- Reconnection indicator -->
    <div id="ws-status" class="hidden fixed top-0 left-0 right-0 bg-red-600 text-white text-center py-1 text-xs z-[60]">
        ‚ö†Ô∏è Reconnecting to server...
    </div>

    <!-- Header -->
    <div class="p-5 pb-0">
        <div class="text-center py-10 px-5 bg-gradient-to-br from-indigo-500 to-purple-700 rounded-xl mb-8 text-white">
            <h1 class="text-4xl font-bold mb-2">üé¨ {{ library_name }}</h1>
            <p id="library-count" class="opacity-90">Loading library...</p>
            <div class="flex flex-wrap justify-center gap-2 mt-6">
                <button id="btn-library" onclick="showTab('library')"
                    class="px-4 py-2 rounded-lg bg-white/20 hover:bg-white/30 transition text-sm font-medium">
                    üìö Library
                </button>
                <button id="btn-jobs" onclick="showTab('jobs')"
                    class="px-4 py-2 rounded-lg hover:bg-white/30 transition text-sm font-medium">
                    ‚öôÔ∏è Jobs
                </button>
                <button id="btn-collections" onclick="showTab('collections')"
                    class="px-4 py-2 rounded-lg hover:bg-white/30 transition text-sm font-medium">
                    üìÅ Collections
                </button>
                <button id="btn-podcasts" onclick="showTab('podcasts')"
                    class="px-4 py-2 rounded-lg hover:bg-white/30 transition text-sm font-medium">
                    üéôÔ∏è Podcasts
                </button>
                <button id="btn-add" onclick="showTab('add')"
                    class="px-4 py-2 rounded-lg hover:bg-white/30 transition text-sm font-medium">
                    ‚ûï Add Content
                </button>
                <button onclick="toggleDarkMode()"
                    class="px-3 py-2 rounded-lg hover:bg-white/30 transition text-sm" title="Toggle dark mode">
                    <span id="dark-mode-icon">‚òÄÔ∏è</span>
                </button>
                {% if auth_enabled %}
                <a href="/logout"
                    class="px-3 py-2 rounded-lg hover:bg-white/30 transition text-sm" title="Logout">üîì</a>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Search -->
    <div id="search-container" class="max-w-xl mx-auto mb-8 px-5">
        <input type="text" id="search" placeholder="üîç Search movies, directors, actors, genres..."
               onkeyup="searchLibrary()"
               class="w-full py-4 px-5 border-none rounded-full bg-white dark:bg-gray-800
                      text-gray-900 dark:text-white placeholder-gray-400
                      focus:outline-none focus:ring-2 focus:ring-indigo-500 shadow-sm">
    </div>

    <!-- Library Tab -->
    <div id="tab-library" class="max-w-7xl mx-auto px-5 pb-12">
        <div id="media-grid" class="grid grid-cols-[repeat(auto-fill,minmax(200px,1fr))] gap-5">
            <div class="text-center py-24 col-span-full opacity-50">Loading your library...</div>
        </div>
    </div>

    <!-- Jobs Tab -->
    <div id="tab-jobs" class="hidden max-w-5xl mx-auto px-5 pb-12">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold">Rip Jobs</h2>
            <div class="flex gap-2">
                <button onclick="rescanLibrary()"
                    class="px-4 py-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg transition text-sm">
                    üîÑ Rescan Library
                </button>
                <button onclick="showRipForm()"
                    class="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition text-sm font-medium">
                    + Rip a Disc
                </button>
            </div>
        </div>
        <div id="jobs-list" class="bg-white dark:bg-gray-800 rounded-xl overflow-hidden shadow-sm">
            <p class="text-center py-12 opacity-50">Loading jobs...</p>
        </div>
    </div>

    <!-- Collections Tab -->
    <div id="tab-collections" class="hidden max-w-7xl mx-auto px-5 pb-12">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold">Collections</h2>
        </div>
        <div id="collections-list">
            <p class="text-center py-12 opacity-50">Loading collections...</p>
        </div>
    </div>

    <!-- Podcasts Tab -->
    <div id="tab-podcasts" class="hidden max-w-5xl mx-auto px-5 pb-12">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold">Podcasts</h2>
            <button onclick="showSubscribeModal()"
                class="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition text-sm font-medium">
                + Subscribe
            </button>
        </div>
        <div id="podcasts-list">
            <p class="text-center py-12 opacity-50">Loading podcasts...</p>
        </div>
    </div>

    <!-- Add Content Tab -->
    <div id="tab-add" class="hidden max-w-3xl mx-auto px-5 pb-12">
        <h2 class="text-2xl font-bold mb-6">Add Content</h2>

        <!-- Upload Section -->
        <div class="bg-white dark:bg-gray-800 rounded-xl p-6 mb-6 shadow-sm">
            <h3 class="text-lg font-semibold mb-3">üì§ Upload Files</h3>
            <div id="drop-zone" class="drop-zone rounded-xl p-12 text-center bg-gray-50 dark:bg-gray-700/50 cursor-pointer"
                 onclick="document.getElementById('file-input').click()">
                <div class="text-5xl mb-3">üìÅ</div>
                <p class="font-medium mb-1">Drag &amp; drop files here</p>
                <p class="text-sm opacity-60">or click to browse &mdash; any file type accepted</p>
                <input id="file-input" type="file" multiple class="hidden" onchange="handleFileSelect(event)">
            </div>
            <div id="upload-progress" class="hidden mt-4">
                <div class="flex items-center gap-3">
                    <div class="flex-1 bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                        <div id="upload-bar" class="bg-indigo-500 rounded-full h-2 transition-all" style="width:0%"></div>
                    </div>
                    <span id="upload-status" class="text-sm">Uploading...</span>
                </div>
            </div>
        </div>

        <!-- Download Video -->
        <div class="bg-white dark:bg-gray-800 rounded-xl p-6 mb-6 shadow-sm">
            <h3 class="text-lg font-semibold mb-3">üé• Download Video</h3>
            <p class="text-sm opacity-60 mb-3">YouTube, Vimeo, or any yt-dlp supported URL</p>
            <div class="flex gap-2">
                <input id="video-url" placeholder="https://youtube.com/watch?v=..."
                       class="flex-1 p-3 rounded-lg bg-gray-100 dark:bg-gray-700 border-none focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                <button onclick="submitVideoDownload()"
                    class="px-5 py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition font-medium whitespace-nowrap">
                    Download
                </button>
            </div>
        </div>

        <!-- Archive Article -->
        <div class="bg-white dark:bg-gray-800 rounded-xl p-6 mb-6 shadow-sm">
            <h3 class="text-lg font-semibold mb-3">üì∞ Archive Article</h3>
            <p class="text-sm opacity-60 mb-3">Save a web article for permanent offline reading</p>
            <div class="flex gap-2">
                <input id="article-url" placeholder="https://example.com/interesting-article"
                       class="flex-1 p-3 rounded-lg bg-gray-100 dark:bg-gray-700 border-none focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                <button onclick="submitArticle()"
                    class="px-5 py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition font-medium whitespace-nowrap">
                    Archive
                </button>
            </div>
        </div>

        <!-- Add Book -->
        <div class="bg-white dark:bg-gray-800 rounded-xl p-6 mb-6 shadow-sm">
            <h3 class="text-lg font-semibold mb-3">üìñ Catalogue a Book</h3>
            <div class="grid grid-cols-2 gap-3">
                <input id="book-title" placeholder="Book title *"
                       class="col-span-2 p-3 rounded-lg bg-gray-100 dark:bg-gray-700 border-none focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                <input id="book-author" placeholder="Author"
                       class="p-3 rounded-lg bg-gray-100 dark:bg-gray-700 border-none focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                <input id="book-year" placeholder="Year"
                       class="p-3 rounded-lg bg-gray-100 dark:bg-gray-700 border-none focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                <textarea id="book-desc" placeholder="Description (optional)" rows="2"
                          class="col-span-2 p-3 rounded-lg bg-gray-100 dark:bg-gray-700 border-none resize-none focus:ring-2 focus:ring-indigo-500 focus:outline-none"></textarea>
            </div>
            <div class="flex justify-end mt-3">
                <button onclick="submitBook()"
                    class="px-5 py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition font-medium">
                    Add Book
                </button>
            </div>
        </div>

        <!-- Import Playlist -->
        <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm">
            <h3 class="text-lg font-semibold mb-3">üéµ Import Playlist</h3>
            <p class="text-sm opacity-60 mb-3">YouTube or Spotify playlist URL</p>
            <div class="flex gap-2">
                <input id="playlist-url" placeholder="https://open.spotify.com/playlist/..."
                       class="flex-1 p-3 rounded-lg bg-gray-100 dark:bg-gray-700 border-none focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                <button onclick="submitPlaylist()"
                    class="px-5 py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition font-medium whitespace-nowrap">
                    Import
                </button>
            </div>
        </div>
    </div>

    <!-- Media Detail Modal -->
    <div id="modal" class="hidden fixed inset-0 bg-black/90 z-[1000] overflow-y-auto" onclick="closeModal()">
        <div class="max-w-5xl mx-auto mt-6 mb-6 px-4" onclick="event.stopPropagation()">
            <div class="flex justify-end mb-2">
                <button onclick="closeModal()" class="text-white text-3xl hover:opacity-70 leading-none">&times;</button>
            </div>
            <div class="bg-white dark:bg-gray-800 rounded-xl overflow-hidden shadow-2xl">
                <video id="modal-video" class="w-full bg-black max-h-[60vh]" controls preload="metadata"></video>
                <audio id="modal-audio" class="hidden w-full" controls preload="metadata"></audio>
                <div class="p-6">
                    <div id="modal-info" class="text-gray-900 dark:text-white"></div>
                    <div class="flex flex-wrap gap-3 mt-6 pt-4 border-t border-gray-200 dark:border-gray-700">
                        <button onclick="downloadMedia()"
                            class="px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition text-sm">
                            ‚¨áÔ∏è Download
                        </button>
                        <button onclick="openEditModal()"
                            class="px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition text-sm">
                            ‚úèÔ∏è Edit Metadata
                        </button>
                        <button onclick="addToCollection()"
                            class="px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition text-sm">
                            üìÅ Add to Collection
                        </button>
                        <button id="btn-restart" onclick="restartMedia()" class="hidden
                            px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition text-sm">
                            ‚èÆÔ∏è Start Over
                        </button>
                    </div>
                    <!-- Queue nav (visible when playing from collection) -->
                    <div id="queue-nav" class="hidden flex items-center justify-between mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
                        <button onclick="queuePrev()" class="px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition text-sm">‚èÆ Previous</button>
                        <span id="queue-position" class="text-sm opacity-60"></span>
                        <button onclick="queueNext()" class="px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition text-sm">Next ‚è≠</button>
                    </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Metadata Modal -->
    <div id="edit-modal" class="hidden fixed inset-0 bg-black/80 z-[1001] flex items-center justify-center p-4" onclick="closeEditModal()">
        <div class="bg-white dark:bg-gray-800 rounded-xl p-6 w-full max-w-lg max-h-[90vh] overflow-y-auto shadow-2xl"
             onclick="event.stopPropagation()">
            <h3 class="text-xl font-bold mb-4">Edit Metadata</h3>
            <div class="space-y-3">
                <div>
                    <label class="block text-sm font-medium mb-1 opacity-70">Title</label>
                    <input id="edit-title" class="w-full p-2 rounded-lg bg-gray-100 dark:bg-gray-700 border-none focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-sm font-medium mb-1 opacity-70">Year</label>
                        <input id="edit-year" class="w-full p-2 rounded-lg bg-gray-100 dark:bg-gray-700 border-none focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1 opacity-70">Rating (0-10)</label>
                        <input id="edit-rating" type="number" step="0.1" min="0" max="10"
                               class="w-full p-2 rounded-lg bg-gray-100 dark:bg-gray-700 border-none focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1 opacity-70">Director</label>
                    <input id="edit-director" class="w-full p-2 rounded-lg bg-gray-100 dark:bg-gray-700 border-none focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1 opacity-70">Genres (comma-separated)</label>
                    <input id="edit-genres" class="w-full p-2 rounded-lg bg-gray-100 dark:bg-gray-700 border-none focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1 opacity-70">Cast (comma-separated)</label>
                    <input id="edit-cast" class="w-full p-2 rounded-lg bg-gray-100 dark:bg-gray-700 border-none focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1 opacity-70">Overview</label>
                    <textarea id="edit-overview" rows="4"
                              class="w-full p-2 rounded-lg bg-gray-100 dark:bg-gray-700 border-none resize-none focus:ring-2 focus:ring-indigo-500 focus:outline-none"></textarea>
                </div>
            </div>
            <div class="flex justify-end gap-3 mt-6">
                <button onclick="closeEditModal()"
                    class="px-4 py-2 rounded-lg bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition">
                    Cancel
                </button>
                <button onclick="saveMetadata()"
                    class="px-4 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-700 text-white transition font-medium">
                    Save Changes
                </button>
            </div>
        </div>
    </div>

    <!-- Rip Disc Modal -->
    <div id="rip-modal" class="hidden fixed inset-0 bg-black/80 z-[1001] flex items-center justify-center p-4" onclick="closeRipModal()">
        <div class="bg-white dark:bg-gray-800 rounded-xl p-6 w-full max-w-lg shadow-2xl"
             onclick="event.stopPropagation()">
            <h3 class="text-xl font-bold mb-4">Rip a Disc</h3>
            <div class="space-y-3">
                <div>
                    <label class="block text-sm font-medium mb-1 opacity-70">Source Path *</label>
                    <input id="rip-source" placeholder="/Volumes/MY_DVD"
                           class="w-full p-2 rounded-lg bg-gray-100 dark:bg-gray-700 border-none focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1 opacity-70">Title (optional, auto-detected from disc)</label>
                    <input id="rip-title" placeholder="Movie Name"
                           class="w-full p-2 rounded-lg bg-gray-100 dark:bg-gray-700 border-none focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1 opacity-70">Title Number</label>
                    <input id="rip-title-num" type="number" value="1" min="1"
                           class="w-full p-2 rounded-lg bg-gray-100 dark:bg-gray-700 border-none focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                </div>
            </div>
            <div class="flex justify-end gap-3 mt-6">
                <button onclick="closeRipModal()"
                    class="px-4 py-2 rounded-lg bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition">
                    Cancel
                </button>
                <button onclick="submitRipJob()"
                    class="px-4 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-700 text-white transition font-medium">
                    Start Ripping
                </button>
            </div>
        </div>
    </div>

    <!-- Subscribe to Podcast Modal -->
    <div id="subscribe-modal" class="hidden fixed inset-0 bg-black/80 z-[1001] flex items-center justify-center p-4" onclick="closeSubscribeModal()">
        <div class="bg-white dark:bg-gray-800 rounded-xl p-6 w-full max-w-lg shadow-2xl"
             onclick="event.stopPropagation()">
            <h3 class="text-xl font-bold mb-4">Subscribe to Podcast</h3>
            <div class="space-y-3">
                <div>
                    <label class="block text-sm font-medium mb-1 opacity-70">RSS Feed URL *</label>
                    <input id="podcast-feed-url" placeholder="https://example.com/feed.xml"
                           class="w-full p-2 rounded-lg bg-gray-100 dark:bg-gray-700 border-none focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1 opacity-70">Title (optional, auto-detected)</label>
                    <input id="podcast-title" placeholder="Podcast Name"
                           class="w-full p-2 rounded-lg bg-gray-100 dark:bg-gray-700 border-none focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                </div>
            </div>
            <div class="flex justify-end gap-3 mt-6">
                <button onclick="closeSubscribeModal()"
                    class="px-4 py-2 rounded-lg bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition">
                    Cancel
                </button>
                <button onclick="submitPodcastSubscription()"
                    class="px-4 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-700 text-white transition font-medium">
                    Subscribe
                </button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
